<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link href="stylesheets/styles.css" type="text/css" rel="stylesheet"/>
    <title>Random Quote Machine</title>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.0.2/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.0.2/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
</head>
<body>
<div id="content">
</div>
<script type="text/babel">

//  Navbar Component Starts
    var Navbar = React.createClass({
        render: function () {
            return (
                    <div className="navbar">
                        <p className="header">Random Quotes Machine</p>
                    </div>
            );
        }
    });
//  Navbar component ends and Quote Component starts.
    var Quote = React.createClass({
        render: function () {
            return (
                    <div className="quote">
                        {this.props.quote}
                    </div>
            );
        }
    });
//  Author starts, Quote Ends.
    var Author = React.createClass({
        render: function () {
            return (
                    <div className="author">
                        <p>{'-'}
                            <i>{this.props.author}</i>
                        </p>
                    </div>
            );
        }
    });
//  Categories Component starts. Idea is to change the Ajax url depending on what category is selected.
//  It doesn't works yet.

    var Categories = React.createClass({
        render: function () {
            var cat_array = ["Programming", "Movies", "Famous"];
//  TODO: Why does clicking on a link with empty string in it's href tag reloads the whole page?
            return (
                <div className="cat_tab">
                    <ul className="cat_list">
                        {cat_array.map(function (cat) {
                            return <a key={cat} className="cat_list_element">
                                <li>
                                    <i>{"#" + cat}</i>
                                </li>
                            </a>;
                        })}
                    </ul>
                </div>
            );
        }
    });
//  QuoteBlock Starts. This is the parent Component for Quote and Author and all other important components.
//  getInitialState sets the initial value of Quote and DIV
//  componentDidMount executes the ajax call and updates the value of quote and author right after the Initial rendering occurs..
//  updateView is passed to onClick handler of button to update Quote and Author when the button is clicked.
    var QuoteBlock = React.createClass({
        getInitialState: function () {
            return {quote: "New Quote here", author: "Quote's Author here"};
        },
        updateView: function () {
            $.ajax({
                url: this.props.url,
                dataType: 'json',
                cache: true,
                headers: {'X-Mashape-Key': 'j2rbmAvhvimshrTJkUHtmBEceNbgp1WJRG6jsnVVTDboDxcAIR', 'Cache-Control': 'max-age=1000'},
                success: function (data) {
                    this.setState({quote: data['quote'], author: data['author']});
                }.bind(this),
                error: function (xhr, status, err) {
                    console.error(this.props.url, err.toString());
                }.bind(this)
            });
        },

//        If I return this.updateView in componentDidMount, It doesn't makes Ajax calls.
//        Hate to write the same code again. Going to work on finding out a solution for this.
        componentDidMount: function () {
            $.ajax({
                url: this.props.url,
                dataType: 'json',
                cache: true,
                headers: {'X-Mashape-Key': 'j2rbmAvhvimshrTJkUHtmBEceNbgp1WJRG6jsnVVTDboDxcAIR', 'Cache-Control': 'max-age=1000'},
                success: function (data) {
                    this.setState({quote: data['quote'], author: data['author']});
                }.bind(this),
                error: function (xhr, status, err) {
                    console.error(this.props.url, err.toString());
                }.bind(this)
            });
        },
        render: function () {
            return (
                    <div className="QuoteBlockParent">
                        <div className="QuoteBlock">
                            <Quote quote={this.state.quote}/>
                            <Author author={this.state.author}/>
                            <Categories />
                            <NewQuote handleClick={this.updateView} />
                            <Tweet quote={this.state.quote} />
                        </div>
                    </div>
            );
        }
    });
//  New Quote Button Component. executes the updateView method from QuoteBlock when clicked. :)
    var NewQuote = React.createClass({
        render: function () {
            return (
                <a className="btn new_quote" onClick={this.props.handleClick}>New Quote</a>
            );
        }
    });
//  Tweet Button  Starts
    var Tweet = React.createClass({
       render: function () {
           var quote = this.props.quote.split(" ").join("%20");
           var url = "https://twitter.com/intent/tweet?text=" + quote;
           return (
             <a className="btn tweet_btn" href={url} target="_blank">tweet</a>
           );
       }
    });
//  The root container of the page.
    var RootElement = React.createClass({
        render: function () {
            return (
                <div className="RootElement">
                    <Navbar />
                    <QuoteBlock url="https://andruxnet-random-famous-quotes.p.mashape.com/?cat=famous"/>
                </div>
            );
        }
    });
//  Finally, Rendering all this inside a div on our page
    ReactDOM.render(
            <RootElement />,
            document.getElementById('content')
    );
</script>
</body>
</html>
